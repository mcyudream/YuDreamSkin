<!DOCTYPE html>
<html lang="ch" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/userCenterLayout::userCenter(~{::section})}">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<section>
    <script src="/js/skinview3d.bundle.js"></script>
    <div class="flex flex-wrap">
        <div class="flex-1 space-y-6">
            <div class="join">
                <button class="btn join-item" onclick="openCreateRoleModal()">创建角色</button>
                <input type="checkbox" id="create-role-modal" class="modal-toggle" />
                <div class="modal" role="dialog">
                    <div class="modal-box">
                       <form method="post" th:action="@{/user/gameProfile/create}">
                           <h3 class="font-bold text-lg mb-4">创建角色</h3>

                           <input name="profileName" id="roleNameInput"
                                  type="text"
                                  placeholder="请输入角色名"
                                  class="input input-bordered w-full" />
                           <div class="modal-action">
                               <button class="btn btn-success" type="submit">确定</button>
                               <label for="create-role-modal" class="btn">取消</label>
                           </div>
                       </form>
                    </div>
                </div>

                <script>
                    /* 打开模态窗 */
                    function openCreateRoleModal() {
                        document.getElementById('create-role-modal').checked = true;
                        document.getElementById('roleNameInput').value = '';   // 清空旧值
                        document.getElementById('roleNameInput').focus();
                    }

                    /* 点击确定 */
                    function confirmCreateRole() {
                        const name = document.getElementById('roleNameInput').value.trim();
                        if (!name) {
                            alert('角色名不能为空');
                            return;
                        }
                        // TODO: 把 name 发到后端或做后续处理
                        console.log('创建角色:', name);

                        /* 关闭模态窗 */
                        document.getElementById('create-role-modal').checked = false;
                    }
                </script>
            </div>
            <div class="overflow-x-auto rounded-box border border-base-content/5 bg-base-100">
                <table class="table">
                    <!-- head -->
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>角色名称</th>
                        <th>上次登录时间</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- row 1 -->
                    <tr th:each="profile:${session.user.profiles}">
                        <th th:text="${profile.key}"></th>
                        <td>Cy Ganderton</td>
                        <td>Quality Control Specialist</td>
                        <td>Blue</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="p-6">

            <canvas id="skinViewer" width="300" height="400"></canvas>
            <input id="skin-url" type="hidden" th:value="${@minioUtils.getPreviewUrl('skin','skin')}">
            <script src="/js/skinUtils.js"></script>
            <script th:inline="javascript">
                const defaultSkinUrl = document.getElementById('skin-url').value;
                const viewer = new skinview3d.SkinViewer({
                    canvas: document.getElementById("skinViewer"),
                    width: 300,
                    height: 400,
                });

                const loadSkin = () => {
                    viewer.loadSkin(document.getElementById("skin-url").value)
                }
                loadSkin()
                const loadCape = () => {

                    viewer.loadCape(document.getElementById("skin-url").value)
                }
                const loadNameTag = () => {
                    const name = document.querySelector("input[name='name']").value
                    if (name === "" || name === undefined){
                        return;
                    }
                    viewer.nameTag = name
                    loadModel()
                }
                const loadModel = () => {
                    const skinType = document.querySelector('input[name="skinType"]:checked').value
                    if (skinType === 'default' || skinType === 'slim') {
                        viewer.loadCape(null)
                        viewer.model = skinType
                        loadSkin()
                    } else if (skinType === 'cape') {
                        viewer.loadSkin(defaultSkinUrl)
                        loadCape()
                    }
                }
            </script>
        </div>
    </div>


</section>
</body>
</html>